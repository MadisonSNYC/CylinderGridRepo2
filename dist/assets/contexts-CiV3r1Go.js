import{r}from"./vendor-ui-CBvPNmAj.js";import{j as _}from"./helix-core-DySbo_Am.js";import{h as v}from"./utils-YRK4nHdM.js";const o={UPDATE_SCROLL:"UPDATE_SCROLL",BATCH_SCROLL_UPDATE:"BATCH_SCROLL_UPDATE",UPDATE_CONFIG:"UPDATE_CONFIG",RESET_CONFIG:"RESET_CONFIG",TOGGLE_EFFECT:"TOGGLE_EFFECT",APPLY_PRESET:"APPLY_PRESET",RESET_EFFECTS:"RESET_EFFECTS",UPDATE_FPS:"UPDATE_FPS",UPDATE_VISIBLE_CARDS:"UPDATE_VISIBLE_CARDS",UNDO:"UNDO",REDO:"REDO",SAVE_HISTORY:"SAVE_HISTORY"},O={scroll:{offset:0,velocity:0,direction:"idle",isAnimating:!1,lastUpdateTime:performance.now()},cards:{visibleIndices:new Set,activeIndex:0,totalProjects:16,repeatTurns:2},config:{perspective:3e3,perspectiveOriginX:71,perspectiveOriginY:32,radius:470,verticalSpan:650,rotateX:-10,rotateY:0,rotateZ:0,cardWidth:180,cardHeight:320,cardScale:1,opacityFront:1,opacitySide:.7,opacityBack:.3,containerWidth:500,containerHeight:400,scrollSensitivity:.5,showEveryNth:1,enableCulling:!1,enableLOD:!1,activeCards:null,renderDistance:null},effects:{centerLogo:!0,centerLogoMode:"billboard",richCardContent:!0,cardHoverEffects:!0,videoPlayOnHover:!0,smoothRotation:!1,depthHierarchy:!1,placementStrength:6,repeatTurns:2,outwardTurn:!0,invertScroll:!1,scrollMode:"wheel"},performance:{currentFPS:60,averageFPS:60,renderTime:0,cacheHitRate:0},history:{past:[],future:[],maxHistory:50}};function k(e,c){switch(c.type){case o.UPDATE_SCROLL:{const{delta:t,timestamp:n=performance.now()}=c.payload,d=e.scroll.offset+t,f=t/Math.max(1,n-e.scroll.lastUpdateTime);return{...e,scroll:{...e.scroll,offset:d,velocity:f,direction:t>0?"down":t<0?"up":"idle",lastUpdateTime:n,isAnimating:Math.abs(f)>.001}}}case o.BATCH_SCROLL_UPDATE:{const{updates:t}=c.payload;return{...e,scroll:{...e.scroll,...t}}}case o.UPDATE_CONFIG:{const{key:t,value:n}=c.payload;return["radius","verticalSpan","repeatTurns","cardScale"].includes(t)&&v.clear(),{...e,config:{...e.config,[t]:n}}}case o.RESET_CONFIG:return v.clear(),{...e,config:O.config};case o.TOGGLE_EFFECT:{const{key:t,value:n}=c.payload;return{...e,effects:{...e.effects,[t]:n}}}case o.APPLY_PRESET:{const{preset:t}=c.payload;return{...e,effects:{...e.effects,...t}}}case o.RESET_EFFECTS:return{...e,effects:O.effects};case o.UPDATE_VISIBLE_CARDS:{const{indices:t}=c.payload;return{...e,cards:{...e.cards,visibleIndices:new Set(t)}}}case o.UPDATE_FPS:{const{current:t,average:n}=c.payload;return{...e,performance:{...e.performance,currentFPS:t,averageFPS:n}}}case o.SAVE_HISTORY:{const t=[...e.history.past,c.payload];return t.length>e.history.maxHistory&&t.shift(),{...e,history:{...e.history,past:t,future:[]}}}case o.UNDO:{if(e.history.past.length===0)return e;const t=e.history.past[e.history.past.length-1],n=e.history.past.slice(0,-1);return{...t,history:{...e.history,past:n,future:[e,...e.history.future]}}}case o.REDO:{if(e.history.future.length===0)return e;const t=e.history.future[0],n=e.history.future.slice(1);return{...t,history:{...e.history,past:[...e.history.past,e],future:n}}}default:return e}}function L(){const[e,c]=r.useReducer(k,O),t=r.useRef([]),n=r.useRef(null),d=r.useMemo(()=>e.scroll,[e.scroll]),f=r.useMemo(()=>e.config,[e.config]),E=r.useMemo(()=>e.effects,[e.effects]),a=r.useMemo(()=>e.performance,[e.performance]),s=r.useCallback((i,y)=>{c({type:o.UPDATE_SCROLL,payload:{delta:i,timestamp:y}})},[]),C=r.useCallback(i=>{t.current.push(i),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{const y=t.current.reduce((F,D)=>({...F,...D}),{});c({type:o.BATCH_SCROLL_UPDATE,payload:{updates:y}}),t.current=[],n.current=null},16)},[]),g=r.useCallback((i,y)=>{c({type:o.UPDATE_CONFIG,payload:{key:i,value:y}})},[]),T=r.useCallback(()=>{c({type:o.RESET_CONFIG})},[]),l=r.useCallback((i,y)=>{c({type:o.TOGGLE_EFFECT,payload:{key:i,value:y}})},[]),S=r.useCallback(i=>{c({type:o.APPLY_PRESET,payload:{preset:i}})},[]),P=r.useCallback(()=>{c({type:o.RESET_EFFECTS})},[]),h=r.useCallback((i,y)=>{c({type:o.UPDATE_FPS,payload:{current:i,average:y}})},[]),p=r.useCallback(i=>{c({type:o.UPDATE_VISIBLE_CARDS,payload:{indices:i}})},[]),R=r.useCallback(()=>{c({type:o.UNDO})},[]),u=r.useCallback(()=>{c({type:o.REDO})},[]),m=e.history.past.length>0,b=e.history.future.length>0;return{state:e,scrollState:d,configState:f,effectsState:E,performanceState:a,updateScroll:s,batchScrollUpdate:C,updateConfig:g,resetConfig:T,toggleEffect:l,applyPreset:S,resetEffects:P,updateFPS:h,updateVisibleCards:p,undo:R,redo:u,canUndo:m,canRedo:b}}const A=r.createContext(null),H=r.createContext(null),U=r.createContext(null);function B({children:e}){const{state:c,scrollState:t,configState:n,effectsState:d,performanceState:f,updateScroll:E,batchScrollUpdate:a,updateConfig:s,resetConfig:C,toggleEffect:g,applyPreset:T,resetEffects:l,updateFPS:S,updateVisibleCards:P,undo:h,redo:p,canUndo:R,canRedo:u}=L(),m=r.useMemo(()=>({scroll:t,cards:c.cards,updateScroll:E,batchScrollUpdate:a,updateVisibleCards:P}),[t,c.cards,E,a,P]),b=r.useMemo(()=>({config:n,effects:d,updateConfig:s,resetConfig:C,toggleEffect:g,applyPreset:T,resetEffects:l,undo:h,redo:p,canUndo:R,canRedo:u}),[n,d,s,C,g,T,l,h,p,R,u]),i=r.useMemo(()=>({performance:f,updateFPS:S}),[f,S]);return _.jsx(A.Provider,{value:m,children:_.jsx(H.Provider,{value:b,children:_.jsx(U.Provider,{value:i,children:e})})})}function w(){const e=r.useContext(A);if(!e)throw new Error("useHelixScroll must be used within HelixProvider");return e}function I(){const e=r.useContext(H);if(!e)throw new Error("useHelixConfig must be used within HelixProvider");return e}function Y(){const e=r.useContext(U);if(!e)throw new Error("useHelixPerformance must be used within HelixProvider");return e}const x={perspective:3e3,perspectiveOriginX:71,perspectiveOriginY:32,radius:470,verticalSpan:650,repeatTurns:1.5,rotateX:-10,rotateY:0,rotateZ:0,cardWidth:180,cardHeight:320,cardScale:1,opacityFront:1,opacitySide:.7,opacityBack:.3,containerWidth:500,containerHeight:400,scrollSensitivity:.5,enableCulling:!1,enableLOD:!1,activeCards:null,renderDistance:null,showEveryNth:1,totalProjects:16,visibleCards:null,scrollOffset:0},j=()=>{const[e,c]=r.useState(x),t=r.useRef([x]),n=r.useRef(0),d=50,f=r.useCallback((l,S)=>{c(P=>{const h={...P,[l]:S};if(!["totalProjects","visibleCards","scrollOffset"].includes(l)){const p=t.current.slice(0,n.current+1);p.push(h),p.length>d&&p.shift(),t.current=p,n.current=p.length-1}return h})},[]),E=r.useCallback(()=>{c(x),t.current=[x],n.current=0},[]),a=r.useCallback(()=>{if(n.current>0){n.current-=1;const l=t.current[n.current];c(l)}},[]),s=r.useCallback(()=>{if(n.current<t.current.length-1){n.current+=1;const l=t.current[n.current];c(l)}},[]),C=n.current>0,g=n.current<t.current.length-1,T=r.useCallback(l=>{c(S=>({...S,...l}))},[]);return{config:e,updateConfig:f,resetConfig:E,undoConfig:a,redoConfig:s,canUndo:C,canRedo:g,updateRuntimeInfo:T}},W=()=>{const[e,c]=r.useState({}),t=r.useCallback(a=>{c(s=>({...s,[a]:!s[a]}))},[]),n=r.useCallback(a=>{c(s=>({...s,[a]:!0}))},[]),d=r.useCallback(a=>{c(s=>({...s,[a]:!1}))},[]),f=r.useCallback(()=>{c({})},[]),E=r.useCallback(a=>{const s={};a.forEach(C=>{s[C]=!0}),c(s)},[]);return{lockedEffects:e,toggleLock:t,lockEffect:n,unlockEffect:d,unlockAll:f,lockAll:E}};function G(){const{config:e,effects:c,updateConfig:t,toggleEffect:n,resetConfig:d,resetEffects:f,undo:E,redo:a,canUndo:s,canRedo:C}=I(),{scroll:g,updateScroll:T}=w(),l=r.useMemo(()=>({...c,repeatTurns:c.repeatTurns||e.repeatTurns||2,placementStrength:c.placementStrength||6}),[c,e]),S=r.useMemo(()=>({...e,scrollOffset:g.offset,scrollSensitivity:e.scrollSensitivity||.5}),[e,g.offset]),P=r.useCallback((u,m)=>{m!==void 0?n(u,m):n(u,!c[u])},[n,c]),h=r.useCallback(u=>{n("placementStrength",u)},[n]),p=r.useCallback(u=>{n("repeatTurns",u)},[n]),R=r.useCallback((u,m)=>{t(u,m)},[t]);return{effects:l,toggleEffect:P,resetEffects:f,undoEffects:E,redoEffects:a,canUndo:s,canRedo:C,setPlacementStrength:h,setRepeatTurns:p,config:S,updateConfig:R,resetConfig:d,scrollOffset:g.offset,updateScroll:T}}function X(){const e=G();return{effects:e.effects,toggleEffect:e.toggleEffect,resetEffects:e.resetEffects,undoEffects:e.undoEffects,redoEffects:e.redoEffects,canUndo:e.canUndo,canRedo:e.canRedo,applyPreset:c=>{Object.entries(c).forEach(([t,n])=>{e.toggleEffect(t,n)})},setPlacementStrength:e.setPlacementStrength,setRepeatTurns:e.setRepeatTurns}}export{B as H,I as a,j as b,W as c,Y as d,X as e,w as u};
